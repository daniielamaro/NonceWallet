<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Histórico de Transações</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="refresh()">
        <ion-icon name="refresh-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" *ngIf="wallet">
  <div class="container">
    <div class="wallet-info" *ngIf="wallet">
      <h3>{{ wallet.name }}</h3>
      <p class="address">{{ wallet.address }}</p>
    </div>

    <div class="transactions-list" *ngIf="!loading && transactions.length > 0">
      <div 
        *ngFor="let tx of transactions" 
        class="transaction-item"
        [class.sent]="tx.type === 'sent'"
        [class.received]="tx.type === 'received'"
        [class.pending]="!tx.confirmed">
        
        <div class="transaction-header">
          <div class="transaction-type">
            <ion-icon 
              [name]="tx.type === 'sent' ? 'arrow-up-circle' : 'arrow-down-circle'"
              [color]="tx.type === 'sent' ? 'danger' : 'success'">
            </ion-icon>
            <span class="type-label">{{ tx.type === 'sent' ? 'Enviado' : tx.type === 'received' ? 'Recebido' : 'Troco' }}</span>
            <ion-badge *ngIf="!tx.confirmed" color="warning" class="pending-badge">Pendente</ion-badge>
          </div>
          <div class="transaction-amount">
            <span class="amount-btc">
              {{ tx.type === 'sent' ? '-' : '+' }}{{ abs(tx.amount).toFixed(8) }} BTC
            </span>
            <span class="amount-fiat">
              ≈ R$ {{ getAmountInBRL(tx.amount) }} / ${{ getAmountInUSD(tx.amount) }}
            </span>
          </div>
        </div>

        <div class="transaction-details">
          <div class="detail-row">
            <span class="detail-label">Data:</span>
            <span class="detail-value">{{ formatDate(tx.blockTime) }}</span>
          </div>
          <div class="detail-row" *ngIf="tx.confirmed && tx.blockHeight">
            <span class="detail-label">Bloco:</span>
            <span class="detail-value">#{{ tx.blockHeight }}</span>
          </div>
          <div class="detail-row" *ngIf="tx.fee > 0">
            <span class="detail-label">Taxa:</span>
            <span class="detail-value">{{ tx.fee.toFixed(8) }} BTC</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">TXID:</span>
            <span class="detail-value txid">{{ tx.txid.substring(0, 16) }}...{{ tx.txid.substring(tx.txid.length - 8) }}</span>
          </div>
        </div>

        <div class="transaction-actions">
          <ion-button fill="clear" size="small" (click)="copyTxId(tx.txid)">
            <ion-icon name="copy-outline" slot="start"></ion-icon>
            Copiar TXID
          </ion-button>
          <ion-button fill="clear" size="small" (click)="openInMempool(tx.txid)">
            <ion-icon name="open-outline" slot="start"></ion-icon>
            Ver no Mempool
          </ion-button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="!loading && transactions.length === 0">
      <ion-icon name="receipt-outline" class="empty-icon"></ion-icon>
      <h3>Nenhuma transação encontrada</h3>
      <p>Este endereço ainda não possui transações na blockchain.</p>
    </div>

    <div class="loading-state" *ngIf="loading">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Carregando histórico...</p>
    </div>
  </div>
</ion-content>

